# 某案件向けSDカードデータロガー + バルブコントローラ

Groveの湿度センサとSparkFunのmicroSDカードシールドを使った簡易データロガー。

2016-06-11 @shuzo_kino

## やってること
 + 一定時間ごとに湿り気を取る
 + 湿り気値をフラグにして(watteState)、バルブを開放
 + 一定時間の始まり時にLEDを点滅させる

## ハード仕様
### 入出力ピン
#### Digital Out
- D7 ソレノイド弁への信号線。Highで開栓、Lowで閉栓。
- D12 赤色LED。エラー用。Highで点灯。
- D13 白色LED。パイロットランプ。Highで点灯。

#### Analog In
- A0 水分計からの信号線。満水で1024、乾燥（端子間開放）で0。
- A1 半固定抵抗右側。ディレイタイム用。反時計回り一杯で0、時計回り一杯で1024。
- A2 半固定抵抗左側。水分量閾値用。同上。

## 仕様

### パイロットランプ
今の状態だと点灯時間が短いので長くする。
写真で動作を確認するので、点灯消灯が同じくらいの時間が良い。

### 開栓シーケンス
水分計の指示値が水分量閾値を下回ったら開栓。
水分計の指示値が水分量閾値を上回ったら、ディレイタイムのカウントを始める。
ディレイタイム分の時間が経ったところで閉栓。

### パラメータ外部入力
水分量閾値とディレイタイムは、参照されるたびに半固定抵抗の値を読みに行く。
水分量閾値は入力そのままで良い。
ディレイタイムは、半固定抵抗の目盛が10分割ほどになっているので、最大10分程度にすると一目盛約1分となってちょうど良いかと。

### エラー
水分計の値が高くなりっぱなし、低くなりっぱなしを赤色LEDでお知らせ。
低い方は、開栓後10分経っても水分量閾値に到達しない場合、閉栓し、エラーを吐いて処理を中断する。
高い方は、前回閉栓した時間から24時間経っても開栓しない場合にエラーを吐く。
高い方の場合は、その後開栓した場合には赤色LEDを消して通常の動作に戻る。

## 参考もと

### 技術面
-  [もう観葉植物を枯らさない！ Arduinoで鉢植えをしゃべらせる@qiita](http://qiita.com/kinu/items/6cd5da0415e31834e7da)
- [ArduinoでSDメモリカードを読み書きする @ なんでもつくっちゃうかも](http://arms22.blog91.fc2.com/blog-entry-502.html)

### 採用部品
- [バルブの商品ページ](https://www.switch-science.com/catalog/814/)

